# 1.3 Poetry

## What is Poetry?

[Poetry](https://python-poetry.org/) stands out as a contemporary tool for Python package and dependency management, aiming to streamline the process of defining, managing, and packaging project dependencies. It fulfills the need for a unified tool capable of handling project setup, dependency resolution, and package distribution, proving to be an essential asset for Python developers.

<figure markdown="span">
  <img src="https://imgs.xkcd.com/comics/python_environment_2x.png" alt="Python Environment" width="500" />
  <figcaption>Python Environment(<a href="https://xkcd.com/1987/">source</a>)</figcaption>
</figure>

## Why do you need a package manager?

In the Python ecosystem, the distribution and installation of software through packages is a standard practice. These packages, often available in Wheel or zip formats, encapsulate source code along with vital metadata. The Wheel format, which is preferred for its efficiency, marks an evolution from the older Egg format, aimed at simplifying package distribution. Manually handling these packages and their dependencies can quickly become cumbersome, underscoring the need for package managers. Tools like Poetry automate these processes, boosting productivity and guaranteeing consistent environments across development and deployment.

## Why should you use Poetry in your project?

Incorporating Poetry into your project brings several key advantages:

- **Improved Environment Management**: Poetry streamlines the management of different project environments, promoting consistent development practices.
- **Simplified Package Building and Distribution**: It provides a unified workflow for building, distributing, and installing packages, easing the complexities usually associated with these tasks.
- **Uniform Project Metadata**: Poetry employs a standardized approach to defining project metadata, including dependencies, authors, and versioning, through a `pyproject.toml` file. This standardization ensures clarity and uniformity.

Compared to traditional approaches that involve pip, venv, and manual dependency management, Poetry offers a more cohesive and friendly experience, merging multiple package and environment management tasks into a single, simplified process.

## How can you install Poetry on your system?

Poetry can be installed through various methods to accommodate different preferences and system setups. The recommended way is via [pipx](https://python-poetry.org/docs/#installation), which installs Poetry in an isolated environment to avoid conflicts with other project dependencies. Confirming the installation is as simple as running `poetry --version` in the terminal, which will display the installed Poetry version.

```bash
# Install pipx on your system
python -m pip install pipx

# install poetry using pipx
pipx install poetry
```

## How can you use Poetry for your MLOps project?

Integrating Poetry into your MLOps project involves several key steps designed to configure and prepare your development environment:

- Begin by creating a new project directory and navigate into it.
- Run `poetry init` in your terminal. This command starts an interactive guide to help set initial project parameters, such as package name, version, description, author, and dependencies. This step generates a `pyproject.toml` file, crucial for your project's configuration under Poetry.
- Run `poetry install` to install the project dependencies and source code. This will let you access your project code through `poetry shell` and its command-line utilities with `poetry run`.

The `pyproject.toml` file plays a central role in defining your projectâ€™s dependencies and settings, with further configuration details available in the Poetry documentation.

```toml
# https://python-poetry.org/docs/pyproject/

# PROJECT

[tool.poetry]
name = "bikes"
version = "1.0.0"
description = "Predict the number of bikes available."
repository = "https://github.com/fmind/mlops-python-package"
documentation = "https://fmind.github.io/mlops-python-package/"
readme = "README.md"
license = "CC BY"
keywords = ["mlops", "python", "package"]
packages = [{ include = "bikes", from = "src" }]

[tool.poetry.scripts]
bikes = 'bikes.scripts:main'

[tool.poetry.dependencies]
python = "^3.12"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
```

At the end of the installation process, a `poetry.lock` file is generated with all the project dependencies that have been installed. You can remove and regenerate the `poetry.lock` file if you wish to update the list of dependencies.

## How can you make your Poetry project easier to manage?

To enhance your Poetry management experience, consider creating a `poetry.toml` file in your project's root with specific virtual environment configurations:

```toml
# https://python-poetry.org/docs/configuration/

[virtualenvs]
in-project = true
prefer-active-python = true
```

These configurations ensure that Poetry creates virtual environments directly within your project directory and prioritizes the active Python interpreter. This practice is aligned with optimal environment management standards. More details are available in the [Poetry documentation on environment management](https://python-poetry.org/docs/managing-environments/).

## How can you install dependencies for your project with Poetry?

Poetry differentiates between main (production) and development dependencies, offering an organized approach to dependency management. To add dependencies, use the following commands:

```bash
# For main dependencies
$ poetry add pandas scikit-learn

# For development dependencies
$ poetry add -G dev ipykernel
```

Executing these commands updates the `pyproject.toml` file, accurately managing and versioning your project's dependencies.

In production, you can decide to install only the main dependencies using [this command](https://python-poetry.org/docs/cli/#install):

```bash
poetry install --only main
```

## Can you use Poetry to download Python dependencies from your own organization's code repository?

Poetry supports incorporating [custom package repositories, including private or organizational ones](https://python-poetry.org/docs/repositories/). This capability allows for the use of proprietary packages in conjunction with those from the public PyPI. Adding a custom repository and setting up authentication is facilitated by Poetry's configuration commands, offering secure and adaptable dependency management.

For a deeper understanding of Poetry's features, including advanced configurations, package specifications, and command instructions, consult the [official Poetry documentation](https://python-poetry.org/docs/). These resources offer detailed insights into leveraging Poetry to its fullest potential in your Python projects.

## Poetry additional resources

- [Dependency Management With Python Poetry](https://realpython.com/dependency-management-python-poetry/)